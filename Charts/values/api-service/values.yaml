# User Service - Production Environment

fullnameOverride: "api-service"

global:
  environment: "prod"
  region: "us-east-1"
  accountId: "123456789012"
  team: "backend"
  costCenter: "platform"

image:
  ecrRepo: "api-service"
  buildId: "v2.1.0"
  pullPolicy: "IfNotPresent"

deployment:
  replicas: 3
  containerPort: 8080
  strategy:
    rollingUpdate:
      maxSurge: "25%"
      maxUnavailable: 1

resources:
  requests:
    cpu: "500m"
    memory: "1Gi"
  limits:
    cpu: "1"
    memory: "2Gi"

autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70

externalSecret:
  dataFrom:
    - extract:
        key: "api-service/prod/secrets"

service:
  type: "ClusterIP"
  ports:
  - port: 8080
    targetPort: 8080
    protocol: TCP
    name: http

ingress:
  enabled: true
  hosts:
    - host: "api.example.com"
      paths:
        - path: "/"
          pathType: "Prefix"

env:
  - name: SPRING_PROFILES_ACTIVE
    value: "prod"
  - name: SERVICE_NAME
    value: "api-service"

configMap:
  data:
    application-prod.yml: |
      server:
        port: 8080
      spring:
        datasource:
          hikari:
            maximum-pool-size: 10
      logging:
        level:
          com.example.userservice: INFO


metadata:
  name: api-service
  namespace: microservices
  env: dev


networkPolicy:
  enabled: true
  ingressNamespace: "ingress-nginx"
  
  # User-service can call order-service
  allowToServices:
    - service: "auth-service"
      port: 8080
  
  # Order-service can call user-service
  allowFromServices:
    - "auth-service"
  
  # Database access
  rdsCidr: "10.0.101.0/24"
  redisCidr: "10.0.201.0/24"